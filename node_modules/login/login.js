var through = require('through2')

module.exports = function (C) {
  var loginForm

  var user = (window.location.host.split('.').length ===  3)
    ? window.location.host.split('.')[0]
    : 'default'

  var s = through.obj(function Write (d, enc, next) { 
    // if (chunk.token && d.token === sessionStorage[user]) C.erase(erase)
    // if (d instanceof Error) 
    //   loginForm.querySelector('input').style.background = 'red'
    next()
  })

  C.onDraw = function (ele) {
    loginForm = ele.querySelector('#loginForm')
    loginForm.addEventListener('submit', sendLogin, false)
  }

  C.onErase = function () {
    loginForm.removeEventListener('submit', sendLogin)
  }

  C.draw()

  function sendLogin (e) {
    e.preventDefault()
    s.push({
      key : 'auth',
      value : {
        origin: C.html.id,
        name: user,
        pass : e.target[0].value
      }
    })
  }

  return s
}

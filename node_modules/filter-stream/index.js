var through = require('through')

module.exports = Filter

function Filter (opts) {
  var self = this
  self = through(function write (chunk) {
    if (typeof chunk === 'string') {
      var d = JSON.parse(chunk)
      if (d[opts.stream]) opts.gate.write(chunk)
      if (!d[opts.stream]) this.queue(chunk)
    } else {
      this.queue(chunk)
    }
  }, function end () {
    this.emit('end')
  }, {autoDestroy:false})
}

var stream = require('stream'),
util = require('util')

// TELE
// STUPID SIMPLE STREAMING MODULE COMMUNICATION
function Tele () {} 

// output stream (instance of stream) **uses readable = true to trigger streams 1 style
Tele.prototype.out = new stream()
Tele.prototype.out.readable = true

// input stream (instance of stream.Writable) 
Tele.prototype.in = new stream.Writable()

// send method: emit data events to out stream
Tele.prototype.send = function (data) {
  Tele.prototype.out.emit('data', data)
}

// pass in module & make it telepathic!
module.exports = function (mod) {
  Object.keys(Tele.prototype).forEach(function(method) {
    mod[method] = Tele.prototype[method]
    if (method === 'in') { // handle _write chunks with recv method 
      mod.in._write = function (chunk,encoding,cb) {
        if (!mod.recv) throw new Error('module needs a recv method') 
        mod.recv(chunk)
        cb()
      }
    }
  })
}
